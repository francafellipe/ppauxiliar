<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>Dashboard </title>
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
    }

    .content {
      padding: 1rem;
      margin-top: 60px;
    }

    .content-container {
      display: none;
    }

    .header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #343a40;
      color: white;
      padding: 0.5rem 1rem;
      z-index: 1000;
    }

    .planilha-table {
      width: 100%;
      margin-top: 1rem;
      background-color: white;
      border: 1px solid #dee2e6;
    }

    .planilha-table th,
    .planilha-table td {
      padding: 0.5rem;
      text-align: center;
    }
  </style>
</head>

<body>
  <header class="header">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Manual Consinco</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <button class="btn btn-primary nav-link" onclick="mostrarConteudo('conferencia-quebra')">Conferência
                quebra</button>
            </li>
            <li class="nav-item">
              <button class="btn btn-primary nav-link" onclick="mostrarConteudo('relatorio-quebra')">Relatório
                Quebra</button>
            </li>
            <li class="nav-item">
              <button class="btn btn-primary nav-link" onclick="mostrarConteudo('estoque-cigarros')">Estoque
                Cigarros</button>
            </li>
            <li class="nav-item">
              <button class="btn btn-primary nav-link" onclick="mostrarConteudo('estoque-par')">Estoque P.A.R</button>
            </li>
            <li class="nav-item">
              <button class="btn btn-primary nav-link" onclick="mostrarConteudo('planilha')">Exibir Planilha
                Atualizada</button>
            </li>
            <li class="nav-item">
              <button class="btn btn-danger nav-link" onclick="logout()">Sair</button>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <div class="content">
    <div class="content-container" id="conferencia-quebra">
      <h2>Conferência de Quebra</h2>
      <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Pariatur nemo eligendi nobis in soluta cupiditate, harum tempora debitis! Ratione, nesciunt. At rerum assumenda corporis dolores officia saepe natus, nostrum provident.</p>
    </div>
    <div class="content-container" id="relatorio-quebra">
      <h2>Relatório de Quebra</h2>
      <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Ipsam qui nulla eveniet fuga consequatur beatae sequi commodi quidem cupiditate aspernatur facilis corporis excepturi, nam provident quisquam reiciendis. Consectetur, a id.</p>
    </div>
    <div class="content-container" id="estoque-cigarros">
      <h2>Estoque Cigarros</h2>
      <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Ipsum unde nostrum error cum doloremque quam accusantium vitae at, soluta laborum maxime consequatur, cumque voluptatibus repellendus, debitis dolorum illum omnis neque?</p>
    </div>
    <div class="content-container" id="estoque-par">
      <h2>Estoque P.A.R</h2>
      <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Doloremque nostrum expedita, repellat amet nisi nobis sapiente natus ipsum, soluta numquam, molestias vero. Illum expedita explicabo, nisi optio iure natus tempore!</p>
    </div>
    <div class="content-container" id="planilha">
      <h2>Atualizar Planilha</h2>
      <form id="form-planilha">
        <div class="form-group">
          <label for="data">Data:</label>
          <input type="text" id="data" name="data" class="form-control" placeholder="dd/mm/aaaa" required>
        </div>
        <div class="form-group">
          <label for="valor-venda">Valor da Venda:</label>
          <input type="text" id="valor-venda" name="valor-venda" class="form-control" required>
        </div>
        <div class="form-group">
          <label for="valor-quebra">Valor da Quebra:</label>
          <input type="text" id="valor-quebra" name="valor-quebra" class="form-control" required>
        </div>
        <button type="button" class="btn btn-primary">Enviar</button>
      </form>

      <table class="table planilha-table">
        <thead>
          <tr>
            <th>Data</th>
            <th>Venda Atual R$</th>
            <th>Meta R$</th>
            <th>Meta %</th>
            <th>Quebra Atual R$</th>
            <th>Meta Quebra R$</th>
            <th>Meta %</th>
            <th>Quebra Atual %</th>
          </tr>
        </thead>
        <tbody id="planilha-body">
          <!-- Aqui serão inseridas as linhas dinamicamente -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const urlSheets = 'https://script.google.com/macros/s/AKfycbxMdzBAN09AWj5o6Ptsn3oJoiTp_fFrl9avmUGBYgTy4JZvjFP-LdvqoZgJKhbvRB9S/exec'
    document.addEventListener('DOMContentLoaded', function () {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if (!currentUser) {
        window.location.href = 'login.html'; // Redireciona para login se não estiver autenticado
      }
      carregarDadosPlanilha();
    });

    function carregarDadosPlanilha() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const dadosSalvos = JSON.parse(localStorage.getItem(`dadosPlanilha_${currentUser.username}`)) || [];

      const tbody = document.getElementById('planilha-body');
      tbody.innerHTML = '';

      dadosSalvos.forEach(dados => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${dados.data}</td>
          <td>${dados.valorVenda}</td>
          <td>R$ 95.161,29</td>
          <td>92,78%</td>
          <td>${dados.valorQuebra}</td>
          <td>R$ 1.094,35</td>
          <td>1,15%</td>
          <td>0,30%</td>
        `;
        tbody.appendChild(row);
      });
    }

    document.querySelector("#form-planilha button").addEventListener("click", function () {
      const data = document.querySelector("#data").value;
      const valorVenda = document.querySelector("#valor-venda").value;
      const valorQuebra = document.querySelector("#valor-quebra").value;

      if (!data || !valorVenda || !valorQuebra) {
        alert("Preencha todos os campos!");
        return;
      }

      const novoDado = {
        data: data,
        valorVenda: valorVenda,
        valorQuebra: valorQuebra
      };

      fetch(urlSheets, {
        method: 'POST',
        body: JSON.stringify(novoDado),
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(response => response.json())
        .then(data => {
          console.log('Success:', data);
          carregarDadosPlanilha();
          document.querySelector("#form-planilha").reset();
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    });

    function mostrarConteudo(id) {
      const containers = document.querySelectorAll(".content-container");
      containers.forEach(container => container.style.display = "none");

      const containerToShow = document.getElementById(id);
      if (containerToShow) {
        containerToShow.style.display = "block";
        const navbarToggler = document.querySelector(".navbar-toggler");
        if (navbarToggler.offsetParent !== null) {
          navbarToggler.click();
        }
      }
    }

    function logout() {
      localStorage.removeItem('currentUser');
      window.location.href = 'login.html';
    }

    function formatarValor(valor) {
      if (valor) {
        valor = valor.replace(/[.,]/g, '');
        const partes = valor.split('.');
        if (partes.length > 1) {
          partes[0] = partes[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
          valor = partes.join(',');
        }
        valor = valor.replace(/,/g, '.');
        if (!valor.startsWith('R$')) {
          valor = 'R$ ' + valor;
        }
      }
      return valor;
    }

    const inputQuebra = document.getElementById('valor-quebra');
    inputQuebra.addEventListener('input', function () {
      inputQuebra.value = formatarValor(inputQuebra.value);
    });

    const inputVenda = document.getElementById('valor-venda');
    inputVenda.addEventListener('input', function () {
      inputVenda.value = formatarValor(inputVenda.value);
    });

    const inputData = document.getElementById('data');
    inputData.addEventListener('input', function () {
      let value = inputData.value;
      value = value.replace(/\D/g, '');
      if (value.length > 8) {
        value = value.substr(0, 8);
      }
      if (value.length > 4) {
        value = value.replace(/^(\d{2})(\d{2})(\d{4})$/, '$1/$2/$3');
      } else if (value.length > 2) {
        value = value.replace(/^(\d{2})(\d{2})$/, '$1/$2');
      }
      inputData.value = value;
    });

  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
